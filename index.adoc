= Z3str4
A Multi-armed String Solver
:toc: left
:stem:

Z3str4 is an SMT solver for the SMT-LIB theory of strings based on Z3. The solver includes two new algorithms for string solving: a length abstraction algorithm and an abstraction-refinement reduction to bit-vectors. Z3str4 also includes an algorithm selection architecture which chooses the best algorithms to run based on their expected performance on the input. This page contains information on downloading and using Z3str4, as well as the results of an extensive experimental evaluation against other leading string solvers.

== Z3str4 String Solver
This website consists of supplementary material to our paper (currently under submission). We share the following components presented in our corresponding paper:

1. Source code

2. Benchmark suite (Benchmarks included) - https://z3str4.github.io/zaligVinder.tar.gz[Download]

3. All Benchmark tracks - https://z3str4.github.io/benchmarks.tar.gz[Download]

=== Compiling Z3str4

Navigate to the z3str4 folder by `cd z3str4` and execute the following steps:

1. `mkdir build`

2. `cd build`

3. `cmake -DCMAKE_BUILD_TYPE=Release ..`

4. `make -j4`

Now Z3str4 is compiled and setup for the benchmark tool.

=== Running Z3str4:
Z3str4 is invoked from the command line with `./z3 smt.string_solver=z3str3 dump_models=true  inputFile.smt` where `inputFile.smt` is the desired SMT-LIB instance, the parameter `smt.string_solver` selects our theory, and `dump_models` asks Z3 to output the found model (if it answers SAT).

=== Simple Example
Using Z3str4 to solve the string constraint `x0 = x1 . x2` and `x0 = solution` is as simple as providing the instance below to Z3str4.

----
(set-logic QF_S)
(declare-fun x0 () String)
(declare-fun x1 () String)
(declare-fun x2 () String)
(assert (= x0 (str.++ x1 x2)))
(assert (= x0 "solution"))
(check-sat)
----

As can be seen from the output below, Z3str4 finds a solution to the equation where it sets `x0 = solution`, and `x1` and `x2` are set to the empty string.

----
sat
(model 
(define-fun x0 () String
"solution")
(define-fun x1 () String
"")
(define-fun x2 () String
"")
)
----

=== Trying the different features of Z3str4
The following information is given inside the help command of Z3str4. The selection corresponds to the newly added parameters directly related to our presented work. The following parameters require the choice of using Z3str3 as the main solver for string constraints. Simply pass `smt.string_solver=z3str3` to your binary to enable it.

==== Using algorithms in isolation

----
str.tactic (unsigned int)
----

This option changes which algorithms are used. 0 - all algorithms, 1 - length abstraction, 2 - arrangement solver (default: 0)

==== Configuration of the length abstraction solver arm

----
str.fixed_length_iterations (unsigned int)
----

Maximum number of attempts to try for the length abstraction solver 

==== Configuration of the sequence solver arm

----
str.pre_milliseconds (unsigned int)
----

Number milliseconds to try sequence solver for disjunctive queries (Z3str3 only) (default: 1000)

==== Using the overlaps feature

----
str.search_overlaps (bool)
----

Continue searching when overlapping variables are detected instead of skipping the branch and returning UNKNOWN (Z3str3 only) (default: true)

----
str.search_overlaps_milliseconds (unsigned int) 
----

number of milliseconds to try searching overlaps with the arrangement solver (Z3str3 only) (default: 5000)

==== Using the constraint sharing between arms

----
str.share_constraints (bool)
----

Enable constraint sharing across tactics (Z3str3 only, has no effect outside of portfolio tactic) (default: true)

== Competing string solvers

As describe in the corresponding paper we are comparing our approach against https://github.com/Z3Prover/z3[Z3Seq], https://sites.google.com/site/z3strsolver/[Z3Str3], and https://cvc4.github.io[CVC4].

=== Z3 Sequence Solver
The Z3 theorem prover  is a DPLL(T)-based SMT solver for theory combinations
over first-order logic. Z3 includes an arithmetic solver for linear integer arithmetic
and a sequence solver (Z3Seq) that supports word-based reasoning about strings.

=== Z3Str3 String Solver
The Z3str3 solver is based on Z3. It uses a reduction known as the arrangement technique to convert word equations into simpler
formulas until a "solved form" is reached. 

=== CVC4 String Solver
The CVC4 solver handles constraints over the theory of strings and arithmetic
using an algebraic approach, and uses a similar DPLL(T) architecture to Z3.

=== Availability
Within the comparison we used CVC4's binary version 1.7 which is available at https://github.com/CVC4/CVC4/releases/download/1.7/cvc4-1.7-x86_64-linux-opt[here]. The sequence solver and Z3str3 were pulled from their official https://github.com/Z3Prover/z3[GIT repository]. To reproduce our results you have to compile the commit https://github.com/Z3Prover/z3/commit/153d0661fe65247d0004bd4577ca851848ca4729[#153d0661fe65247d0004bd4577ca851848ca4729] using the same steps as described above for Z3str4.



== Benchmarks
=== Running the Benchmarks

[WARNING]
This benchmark tool was tested on Python 3.7.6.

Navigate to the benchmarks folder by `cd wordbenchmarks` and execute the following steps:

. Modify the `toolconfig.json` according to your filepaths:

----
{
"Binaries" : {
		"Z3str4" : {
			"path" : "../tools/Z3str4/z3"
		},
		"Z3" : {
			"path" : "../tools/z3/z3"
		},
		"cvc4" : {
			"path" : "../tools/cvc4/cvc4"
		}
	}
}
----

[start=2]
. Install the python3 libs matplotlib, tabulate and npyscreen by executing:

`pip3 install matplotlib tabulate npyscreen`

[start=3]
. Start the benchmark run by executing 

`python3 z3str4run`

Once the benchmark run finished, the tool automatically starts a webserver on your local machine. You can browse the results by visiting the URL http://localhost:8081.

[.text-center]
image::benchmarkGUI.png[GUI Screenshot]

=== A detailed view on the benchmarks

All tests were performed on a server running Ubuntu 18.04.3 LTS with 2 Intel Xeon Gold 6242 CPUs each having 16 cores and 1.5 TB of memory.
